ğŸš€ VERONA CARD HPC
================================================
Job ID: 19299971
Nodo: lrdn1401.leonardo.local
Data: Sun Aug 24 14:38:49 CEST 2025
ğŸ¯ ModalitÃ : Produzione stabile (4x A100, anti-contention)

ğŸ“¦ Setup ambiente HPC...
Loading python/3.11.6--gcc--8.5.0
  Loading requirement: bzip2/1.0.8-gp5wcz5 libmd/1.0.4-wja3f5q
    libbsd/0.11.7-cgxjopl expat/2.5.0-bptl3xw ncurses/6.4-asx3jea
    readline/8.2-nyw6mp6 gdbm/1.23-fs6otck libiconv/1.17-d7yvx2s
    xz/5.4.1-hubmwr5 zlib-ng/2.1.4-6htiapk libxml2/2.10.3-5eeeokp
    pigz/2.7-bopr5vp zstd/1.5.5-gawytfl tar/1.34-amqus5s gettext/0.22.3-2g7elif
    libffi/3.4.4-6r7brdq libxcrypt/4.4.35-ss2rzin sqlite/3.43.2
    util-linux-uuid/2.38.1-jkdi7kv
âœ… Python: Python 3.11.6
âœ… CUDA: Cuda compilation tools, release 12.3, V12.3.103

ğŸ” GPU DETECTION:
0, NVIDIA A100-SXM-64GB, 65536 MiB, 43
1, NVIDIA A100-SXM-64GB, 65536 MiB, 43
2, NVIDIA A100-SXM-64GB, 65536 MiB, 43
3, NVIDIA A100-SXM-64GB, 65536 MiB, 43
SLURM GPUs: 4

ğŸ’¾ LEONARDO BOOSTER: Setup spazio temporaneo ottimizzato...
ğŸ“Š Spazio /tmp Leonardo Booster: 10GB disponibili su ~10GB totali
âœ… Configurazione Leonardo Booster:
   ğŸ“ /tmp originale: 10GB (TROPPO PICCOLO per Mixtral)
   ğŸ“ Directory custom: /leonardo_work/IscrC_LLM-Mob/tmp_ollama_19299971
   ğŸ’¾ Spazio $WORK disponibile: 951GB
   ğŸ¯ Mixtral richiede ~26GB temporanei - OK con $WORK

ğŸ§¹ Cleanup preventivo Leonardo Booster...
ğŸ” Stato spazio post-cleanup:
ğŸ’¾ /tmp: 10G disponibili
ğŸ’¾ $WORK: 952G disponibili
ğŸ“‚ Directory temporanea: total 8.0K
drwx------  2 smattiol interactive   4.0K Aug 24 14:38 .
drwxrwx--- 11 smattiol IscrC_LLM-Mob 4.0K Aug 24 14:38 ..
ğŸ” Configurazioni Ollama attive:
OLLAMA_BATCH_SIZE=1024
OLLAMA_CACHE_DIR=/leonardo_work/IscrC_LLM-Mob/.ollama/cache
OLLAMA_CONTEXT_SIZE=4096
OLLAMA_CUDA_MEMORY_FRACTION=0.85
OLLAMA_DEBUG=1
OLLAMA_FLASH_ATTENTION=1
OLLAMA_GPU_LAYERS=-1
OLLAMA_KEEP_ALIVE=4h
OLLAMA_LLM_LIBRARY=cuda_v12
OLLAMA_LOAD_TIMEOUT=7200
OLLAMA_MAX_CONCURRENT_DOWNLOADS=1
OLLAMA_MAX_LOADED_MODELS=1
OLLAMA_MAX_QUEUE=1
OLLAMA_MAX_VRAM_USAGE=0.85
OLLAMA_MODELS=/leonardo_work/IscrC_LLM-Mob/.ollama/models
OLLAMA_NUM_PARALLEL=1
OLLAMA_ORIGINS=*
OLLAMA_PREDICTION_TOKENS=512
OLLAMA_REQUEST_TIMEOUT=1200
OLLAMA_RUNNER_CACHE_SIZE=8GB
OLLAMA_SERVER_TIMEOUT=7200
OLLAMA_TMPDIR=/leonardo_work/IscrC_LLM-Mob/tmp_ollama_19299971
OLLAMA_VERBOSE=1

ğŸ§¹ Cleanup preventivo...
ğŸ” Controllo stato GPU post-cleanup...
0, NVIDIA A100-SXM-64GB, 2 MiB, 43
1, NVIDIA A100-SXM-64GB, 2 MiB, 43
2, NVIDIA A100-SXM-64GB, 2 MiB, 42
3, NVIDIA A100-SXM-64GB, 2 MiB, 42
# gpu         pid  type    sm    mem    enc    dec    command
# Idx           #   C/G     %      %      %      %    name
    0          -     -     -     -     -     -   -              
    1          -     -     -     -     -     -   -              
    2          -     -     -     -     -     -   -              
    3          -     -     -     -     -     -   -              

ğŸš€ Avvio server Ollama con anti-contention...

ğŸš€ Avvio server Ollama con anti-contention POTENZIATO...
ğŸ”¡ Avvio istanza 1/4 (MASTER)...
ğŸ”¥ Avvio ROBUSTO istanza GPU 0 su porta 39001...
ğŸ§¹ Cleanup specifico porta 39001...
âœ… GPU 0: spazio OK (951GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu0
ğŸš€ Avvio Ollama GPU 0 con timeout esteso...
âœ… GPU 0 PID: 583229 (timeout startup: 900s)
   ğŸ“ Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu0
   ğŸ“„ Log: ollama_gpu0.log
âœ… GPU 0: processo avviato correttamente
â³ Attesa caricamento modello su GPU 0 MASTER (180s)...
ğŸ”¡ Avvio istanza 2/4...
ğŸ”¥ Avvio ROBUSTO istanza GPU 1 su porta 39002...
ğŸ§¹ Cleanup specifico porta 39002...
âœ… GPU 1: spazio OK (948GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu1
ğŸš€ Avvio Ollama GPU 1 con timeout esteso...
âœ… GPU 1 PID: 583622 (timeout startup: 900s)
   ğŸ“ Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu1
   ğŸ“„ Log: ollama_gpu1.log
âœ… GPU 1: processo avviato correttamente
â³ Attesa stabilizzazione GPU 1 (90s)...
ğŸ”¡ Avvio istanza 3/4...
ğŸ”¥ Avvio ROBUSTO istanza GPU 2 su porta 39003...
ğŸ§¹ Cleanup specifico porta 39003...
âœ… GPU 2: spazio OK (946GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu2
ğŸš€ Avvio Ollama GPU 2 con timeout esteso...
âœ… GPU 2 PID: 583738 (timeout startup: 900s)
   ğŸ“ Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu2
   ğŸ“„ Log: ollama_gpu2.log
âœ… GPU 2: processo avviato correttamente
â³ Attesa stabilizzazione GPU 2 (90s)...
ğŸ”¡ Avvio istanza 4/4...
ğŸ”¥ Avvio ROBUSTO istanza GPU 3 su porta 39004...
ğŸ§¹ Cleanup specifico porta 39004...
âœ… GPU 3: spazio OK (943GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu3
ğŸš€ Avvio Ollama GPU 3 con timeout esteso...
âœ… GPU 3 PID: 584069 (timeout startup: 900s)
   ğŸ“ Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu3
   ğŸ“„ Log: ollama_gpu3.log
âœ… GPU 3: processo avviato correttamente
â³ Attesa stabilizzazione GPU 3 (90s)...
â³ Attesa stabilizzazione COMPLETA sistema (120s)...
ğŸ” Verifica processi Ollama attivi:
âœ… GPU 0: PID 583229 attivo
âœ… GPU 1: PID 583622 attivo
âœ… GPU 2: PID 583738 attivo
âœ… GPU 3: PID 584069 attivo

ğŸ” Health check SUPER-ROBUSTO multi-istanza...
ğŸ“‹ Prima passata health check...
ğŸ” Health check GPU 0 (porta 39001)...
ğŸ‘‘ GPU 0 MASTER - timeout esteso (30 tentativi)
   ğŸ”„ Tentativo 1/30...
   ğŸŒ Test connessione...
   âœ… Connessione OK, test funzionalitÃ ...
   âš ï¸ Test inference fallito, risposta parziale: ...
   ğŸ”„ Tentativo 2/30...
   ğŸŒ Test connessione...
   âœ… Connessione OK, test funzionalitÃ ...
   âš ï¸ Test inference fallito, risposta parziale: ...
   ğŸ”„ Tentativo 3/30...
   ğŸŒ Test connessione...
   âœ… Connessione OK, test funzionalitÃ ...
   âœ… GPU 0 COMPLETAMENTE OPERATIVA dopo 3 tentativi
GPU 0 fallita prima passata
ğŸ” Health check GPU 1 (porta 39002)...
   ğŸ”„ Tentativo 1/20...
   ğŸŒ Test connessione...
   âœ… Connessione OK, test funzionalitÃ ...
   âœ… GPU 1 COMPLETAMENTE OPERATIVA dopo 1 tentativi
ğŸ” Health check GPU 2 (porta 39003)...
   ğŸ”„ Tentativo 1/20...
   ğŸŒ Test connessione...
   âœ… Connessione OK, test funzionalitÃ ...
   âœ… GPU 2 COMPLETAMENTE OPERATIVA dopo 1 tentativi
ğŸ” Health check GPU 3 (porta 39004)...
   ğŸ”„ Tentativo 1/20...
   ğŸŒ Test connessione...
   âœ… Connessione OK, test funzionalitÃ ...
   âœ… GPU 3 COMPLETAMENTE OPERATIVA dopo 1 tentativi
ğŸ“Š Prima passata: 4/4 istanze operative
ğŸ“Š Health check finale: 4/4 istanze operative
âœ… Sistema OTTIMO: 4 GPU operative

ğŸ”¥ VERIFICA E PREPARAZIONE MODELLO FINALE
========================================
ğŸ” Verifica modello mixtral:8x7b...
ğŸ” Tentativo check modello su porta 39001 (GPU 0)...
âœ… Connessione modello OK su porta 39001
ğŸ” Modello presente: true
âœ… Modello giÃ  presente

ğŸ”¥ WARM-UP REALE E DEFINITIVO
============================
âš ï¸ Questo Ã¨ il test FINALE che determina quali GPU sono REALMENTE pronte
â³ PuÃ² richiedere 3-10 minuti ma Ã¨ ESSENZIALE per evitare errori 503

ğŸ¯ Test FINALE GPU 0...
ğŸ¯ TEST REALE GPU 0 (porta 39001)...
   ğŸ“¡ Pre-test connettivitÃ ...
   âœ… Servizio risponde, procedo con test inferenza
   ğŸ”„ Tentativo 1/15 (test reale inferenza)...
   âœ… GPU 0 REALMENTE OPERATIVA!
âœ… GPU 1 CERTIFICATA come pronta
â¸ï¸ Pausa anti-contention (30s)...

ğŸ¯ Test FINALE GPU 1...
ğŸ¯ TEST REALE GPU 1 (porta 39002)...
   ğŸ“¡ Pre-test connettivitÃ ...
   âœ… Servizio risponde, procedo con test inferenza
   ğŸ”„ Tentativo 1/15 (test reale inferenza)...
   âœ… GPU 1 REALMENTE OPERATIVA!
âœ… GPU 1 CERTIFICATA come pronta
â¸ï¸ Pausa anti-contention (30s)...

ğŸ¯ Test FINALE GPU 2...
ğŸ¯ TEST REALE GPU 2 (porta 39003)...
   ğŸ“¡ Pre-test connettivitÃ ...
   âœ… Servizio risponde, procedo con test inferenza
   ğŸ”„ Tentativo 1/15 (test reale inferenza)...
   âœ… GPU 2 REALMENTE OPERATIVA!
âœ… GPU 1 CERTIFICATA come pronta
â¸ï¸ Pausa anti-contention (30s)...

ğŸ¯ Test FINALE GPU 3...
ğŸ¯ TEST REALE GPU 3 (porta 39004)...
   ğŸ“¡ Pre-test connettivitÃ ...
   âœ… Servizio risponde, procedo con test inferenza
   ğŸ”„ Tentativo 1/15 (test reale inferenza)...
   âœ… GPU 3 REALMENTE OPERATIVA!
âœ… GPU 1 CERTIFICATA come pronta
â¸ï¸ Pausa anti-contention (30s)...

ğŸ“Š RISULTATO FINALE WARM-UP:
   ğŸ¯ GPU testate: 4
   âœ… GPU REALMENTE pronte: 4
   ğŸš€ Porte certificate: 39001,39002,39003,39004
âœ… 4 GPU certificate - sistema pronto!
ğŸ’¾ Porte certificate salvate: 39001,39002,39003,39004

ğŸ“‚ Verifica file di input...
âœ… File verificato: data/verona/veronacard_2022_original.csv (29M, 382346 righe)
ğŸ“‚ Directory results: drwxr-xr-x 2 smattiol interactive 4096 Aug 24 10:08 results/

ğŸ” DEBUG: Stato sistema pre-esecuzione
Timestamp: 2025-08-24 14:56:27
Uptime job: 1058 secondi
Memoria disponibile: 489Gi
Spazio disco: 944G
ğŸ” Processi Ollama attivi:
âŒ PID 583229 terminato
âœ… PID 583622 attivo
âœ… PID 583738 attivo
âœ… PID 584069 attivo

ğŸ¯ AVVIO ELABORAZIONE STABILIZZATA
=================================
ğŸ“Š Configurazione Python finale:
   ğŸ¯ GPU certificate: 4
   âš¡ Concurrent requests: 4
   â±ï¸ Timeout richiesta: 600
   ğŸ“¦ Batch size: 100
   ğŸš€ Porte attive: 39001,39002,39003,39004

ğŸŒ TEST FINALE: Verifica porte certificate
âŒ Porta 39001: PROBLEMA nel test finale
âœ… Porta 39002: CONFERMATA operativa
âœ… Porta 39003: CONFERMATA operativa
âœ… Porta 39004: CONFERMATA operativa
âš ï¸ WARNING: 3/4 porte rispondono nel test finale
Procediamo comunque (le porte potrebbero essere temporaneamente occupate)

ğŸ¯ SISTEMA CERTIFICATO E PRONTO PER PYTHON
==========================================
âœ… Setup HPC completato con successo
ğŸš€ GPU certificate: 4
âš¡ Porte attive: 39001,39002,39003,39004
ğŸ“Š Tempo setup totale: 1058 secondi
ğŸ” Monitor sistema POTENZIATO avviato (intervallo: 300s)
ğŸš€ Avvio script Python stabilizzato...
ğŸ“„ Target: data/verona/veronacard_2022_original.csv
â° Inizio: 2025-08-24 14:56:27

2025-08-24 14:56:55 [INFO] Initializing Ollama connection manager...
2025-08-24 14:56:55 [WARNING] HostHealthMonitor initialized with empty host list
2025-08-24 14:56:55 [INFO] Setting up connections...
2025-08-24 14:56:55 [INFO] Multi-GPU configuration: 4 instances
2025-08-24 14:56:55 [INFO] Initialized with 4 hosts
2025-08-24 14:56:55 [INFO] Waiting for Ollama services to start...
2025-08-24 14:56:55 [INFO] Checking host 1/4: http://127.0.0.1:39001
2025-08-24 14:58:22 [ERROR] Host http://127.0.0.1:39001 failed to respond after 30 attempts
2025-08-24 14:58:22 [ERROR] Fatal error: Ollama services failed to start

ğŸ‰ ELABORAZIONE COMPLETATA CON SUCCESSO!
â±ï¸ Tempo Python: 116 sec (0h 1m)

ğŸ“‹ REPORT FINALE HPC STABILIZZATO
=================================
â±ï¸ Tempo totale job: 1174 sec (0h 19m)
   ğŸ“¡ Setup sistema: 1756040187 sec
   ğŸ Elaborazione Python: 116 sec
   ğŸ§¹ Cleanup: -1756039129 sec
ğŸš€ ModalitÃ : HPC stabilizzato (4x A100 anti-contention)
âœ… Esito Python: true

ğŸ“Š ANALISI RISULTATI:
   ğŸ“ File CSV generati: 6
   ğŸ’¾ Dimensione totale: 69M
   âš¡ Throughput: 186.20 files/hour
   ğŸ¯ Rate stimato: 51.7 carte/sec

   ğŸ“‹ File recenti generati:
     -rw-r--r-- 1 smattiol interactive  20M Aug 24 14:57 results/dati_2015_pred_20250823_170255.csv
     -rw-r--r-- 1 smattiol interactive  33M Aug 24 10:27 results/dati_2014_pred_20250822_090359.csv
     -rw-r--r-- 1 smattiol interactive 4.9M Aug 22 11:09 results/dati_2017_pred_20250822_091800.csv

ğŸ”§ STATO GPU FINALE:
GPU0 ( NVIDIA A100): Mem % Util  0 %% Temp  43Â°C Power  65.00 WW
GPU1 ( NVIDIA A100): Mem % Util  0 %% Temp  43Â°C Power  68.43 WW
GPU2 ( NVIDIA A100): Mem % Util  0 %% Temp  43Â°C Power  74.60 WW
GPU3 ( NVIDIA A100): Mem % Util  0 %% Temp  43Â°C Power  78.81 WW

ğŸ“œ SAMPLE LOG OLLAMA (troubleshooting):
GPU 0: 5 errors, 5 warnings
   Ultimi errori:
     time=2025-08-24T14:51:51.290+02:00 level=ERROR source=sched.go:455 msg="error loading llama server" error="timed out waiting for llama runner to start: context canceled"
     time=2025-08-24T14:52:01.369+02:00 level=INFO source=server.go:621 msg="waiting for server to become available" status="llm server error"
GPU 1: 1 errors, 1 warnings
   Ultimi errori:
     time=2025-08-24T14:52:44.203+02:00 level=INFO source=server.go:621 msg="waiting for server to become available" status="llm server error"
GPU 2: 1 errors, 2 warnings
   Ultimi errori:
     time=2025-08-24T14:53:14.931+02:00 level=INFO source=server.go:621 msg="waiting for server to become available" status="llm server error"
GPU 3: 1 errors, 3 warnings
   Ultimi errori:
     time=2025-08-24T14:53:49.183+02:00 level=INFO source=server.go:621 msg="waiting for server to become available" status="llm server error"

ğŸ‰ JOB HPC COMPLETATO CON SUCCESSO!
âš¡ Elaborazione stabilizzata su 4x A100 completata senza errori critici
ğŸ“ˆ Performance: sistema stabile e produttivo
/var/spool/slurmd/job19299971/slurm_script: line 990: [: -lt: unary operator expected

ğŸ Fine job: 2025-08-24 14:58:23
ğŸ“Š Job ID: 19299971
ğŸ–¥ï¸ Nodo: lrdn1401.leonardo.local
=================================
ğŸ§¹ CLEANUP STABILIZZATO...
ğŸ”„ Shutdown graceful PID 583738...
ğŸ”„ Shutdown graceful PID 584069...
â³ Attesa shutdown (30s)...
ğŸ”¨ Force cleanup...
âœ… Cleanup completato
