🚀 VERONA CARD HPC OTTIMIZZATO
==============================
Job ID: 19273815
Nodo: lrdn1401.leonardo.local
Data: Fri Aug 22 22:26:08 CEST 2025
🎯 Modalità: Produzione ottimizzata (4x A100, rate-limited)

📦 Setup ambiente HPC...
Loading python/3.11.6--gcc--8.5.0
  Loading requirement: bzip2/1.0.8-gp5wcz5 libmd/1.0.4-wja3f5q
    libbsd/0.11.7-cgxjopl expat/2.5.0-bptl3xw ncurses/6.4-asx3jea
    readline/8.2-nyw6mp6 gdbm/1.23-fs6otck libiconv/1.17-d7yvx2s
    xz/5.4.1-hubmwr5 zlib-ng/2.1.4-6htiapk libxml2/2.10.3-5eeeokp
    pigz/2.7-bopr5vp zstd/1.5.5-gawytfl tar/1.34-amqus5s gettext/0.22.3-2g7elif
    libffi/3.4.4-6r7brdq libxcrypt/4.4.35-ss2rzin sqlite/3.43.2
    util-linux-uuid/2.38.1-jkdi7kv
✅ Python: Python 3.11.6
✅ CUDA: Cuda compilation tools, release 12.3, V12.3.103

🔍 GPU DETECTION:
0, NVIDIA A100-SXM-64GB, 65536 MiB, 43
1, NVIDIA A100-SXM-64GB, 65536 MiB, 43
2, NVIDIA A100-SXM-64GB, 65536 MiB, 42
3, NVIDIA A100-SXM-64GB, 65536 MiB, 42
SLURM GPUs: 4

🚀 Avvio server Ollama ottimizzato (4x GPU)...
🔍 Controllo stato GPU...
0, NVIDIA A100-SXM-64GB, 2 MiB, 43
1, NVIDIA A100-SXM-64GB, 2 MiB, 43
2, NVIDIA A100-SXM-64GB, 2 MiB, 42
3, NVIDIA A100-SXM-64GB, 2 MiB, 42
# gpu         pid  type    sm    mem    enc    dec    command
# Idx           #   C/G     %      %      %      %    name
    0          -     -     -     -     -     -   -              
    1          -     -     -     -     -     -   -              
    2          -     -     -     -     -     -   -              
    3          -     -     -     -     -     -   -              
🔥 Avvio istanza GPU 0 su porta 39001...
✅ GPU 0 PID: 392092
🔥 Avvio istanza GPU 1 su porta 39002...
✅ GPU 1 PID: 392121
🔥 Avvio istanza GPU 2 su porta 39003...
✅ GPU 2 PID: 392147
🔥 Avvio istanza GPU 3 su porta 39004...
✅ GPU 3 PID: 392173
✅ Tutte le istanze avviate:
   GPU 0: PID 156 (porta 39001)
   GPU 1: PID 185 (porta 39002)
   GPU 2: PID 211 (porta 39003)
   GPU 3: PID 237 (porta 39004)

⏳ Verifica health multi-istanza...
🔍 Check GPU 0 (porta 39001)...
✅ GPU 0 operativa
🔍 Check GPU 1 (porta 39002)...
✅ GPU 1 operativa
🔍 Check GPU 2 (porta 39003)...
✅ GPU 2 operativa
🔍 Check GPU 3 (porta 39004)...
✅ GPU 3 operativa
📊 Health check: 4/4 istanze operative

📥 Preparazione modello su tutte le GPU...
🔍 Verifica modello mixtral:8x7b...
🔥 Pre-caricamento distribuito...
⚡ Warm-up GPU 0...
⚡ Warm-up GPU 1...
⚡ Warm-up GPU 2...
🚨 DEBUG: PIDs preload salvati: 392240 392241 392242 392243
⏳ Attesa completamento preload (max 120s)...
⚡ Warm-up GPU 3...
⏳ Preload in corso... (4/4 attivi, 0s)
✅ GPU 3 pronta
⏳ Preload in corso... (3/4 attivi, 15s)
⏳ Preload in corso... (3/4 attivi, 30s)
⏳ Preload in corso... (3/4 attivi, 45s)
⏳ Preload in corso... (3/4 attivi, 60s)
⏳ Preload in corso... (3/4 attivi, 75s)
⏳ Preload in corso... (3/4 attivi, 90s)
✅ GPU 0 pronta
✅ GPU 2 pronta
✅ GPU 1 pronta
✅ Tutti i preload completati in 99s
🔍 DEBUG: Stato finale preload:
  PID 392240: TERMINATO
  PID 392241: TERMINATO
  PID 392242: TERMINATO
  PID 392243: TERMINATO

🔍 DEBUG: Punto critico post warm-up
Timestamp: 2025-08-22 22:28:50
Uptime processo: 162 secondi
Directory corrente: /leonardo_work/IscrC_LLM-Mob/LLM-Mob-As-Mobility-Interpreter
Spazio disco disponibile: 10.128.82.1@o2ib:10.128.82.2@o2ib:/larchive/work  1.0T   89G  936G   9% /leonardo_work
Memoria disponibile:               total        used        free      shared  buff/cache   available
Mem:          502Gi       7.2Gi       456Gi       7.7Gi        39Gi       481Gi
Swap:            0B          0B          0B

📋 DEBUG: Verifica ambiente Python
File Python esiste: -rw-r--r-- 1 smattiol interactive 62873 Aug 22 16:40 veronacard_mob_with_geom_parrallel.py
Directory data: DIRECTORY NON TROVATA
File input: FILE NON TROVATO

🧪 DEBUG: Test Python veloce
Python path: /leonardo_work/IscrC_LLM-Mob/venv/bin/python3
✅ Pandas OK
✅ Requests OK
✅ Python base OK

🔍 DEBUG: Stato processi Ollama
❌ PID 156 terminato
❌ PID 185 terminato
❌ PID 211 terminato
❌ PID 237 terminato

🌐 DEBUG: Test connettività finale
✅ Porta 39001 risponde
✅ Porta 39002 risponde
✅ Porta 39003 risponde
✅ Porta 39004 risponde

🎯 DEBUG: Inizio sezione Python
===============================================

🎯 AVVIO ELABORAZIONE OTTIMIZZATA
================================
📊 Configurazione finale:
   🎯 GPU operative: 4/4
   ⚡ Rate limit: 4 richieste concurrent
   💾 Salvataggio incrementale: ogni 100 carte
   🔄 Timeout richiesta: 240s
   🛡️ Circuit breaker: attivo

📍 Directory dopo cd: /leonardo_work/IscrC_LLM-Mob/LLM-Mob-As-Mobility-Interpreter
📁 Contenuto directory:
total 888
drwxr-xr-x 24 smattiol interactive     4096 Aug 22 22:26 .
drwxrwx--- 10 smattiol IscrC_LLM-Mob   4096 Aug 15 18:50 ..
drwxr-xr-x  2 smattiol interactive     4096 Aug 22 16:51 BACK UP FUNZIONANTE PARALLEL
drwxr-xr-x  6 smattiol interactive     4096 Aug 15 18:41 data
drwxr-xr-x  4 smattiol interactive     4096 Aug 20 09:58 DOCUMENTAZIONE UFFICIALE
-rw-r--r--  1 smattiol interactive     8196 Aug 15 18:41 .DS_Store
-rw-r--r--  1 smattiol interactive       29 Aug 22 14:52 fatti.tzt
drwxr-xr-x  5 smattiol interactive     4096 Aug 15 18:41 file llm-Mob
drwxr-xr-x  8 smattiol interactive     4096 Aug 22 15:55 .git
📂 Directory results creata: drwxr-xr-x 2 smattiol interactive 4096 Aug 22 09:23 results/
🚀 Avvio script Python ottimizzato...
📄 File target: veronacard_2023_original_parziale.csv
⏰ Timestamp inizio: 2025-08-22 22:29:03

🔍 DEBUG: Test comando Python (dry run)
✅ Argomenti Python parsati correttamente
   File: veronacard_2020_2023/veronacard_2023_original_parziale.csv
   Append: False

🎬 INIZIO ESECUZIONE PYTHON REALE
- BACK UP FUNZIONANTE PARALLEL data DOCUMENTAZIONE UFFICIALE fatti.tzt file llm-Mob img LICENSE logs mini run con geometrie da MACBOOK notebook ollama_config.json ollama_gpu0.log ollama_gpu1.log ollama_gpu2.log ollama_gpu3.log ollama_info.txt ollama_models.txt ollama_ports.txt ollama_port.txt ollama_production.log PARALLEL MAX PERFORMANCE parallel_production_run_4_GPU.sh parallel_production_run.sh prima run di DEBUG with geom da Leonardo production_run.sh README.md requirements.txt result_run_completa_with_geom_srv_univr results results_2025_05_10_(_prima_run_su_srv_univr_LITE_) results_leo_with_geom_n-1_come_current_POI results_leo_with_geom_parziali results_parziali_ministral results semi-completi ministral results_short results_srv_univr_(_no_SPACE-GEO_n-1_come_current_POI_) slurm-19273279.out slurm-19273315.out slurm-19273358.out slurm-19273815.out venv veronacard_mob.py veronacard_mob_versione_base.py veronacard_mob_with_geom_parrallel.py veronacard_mob_with_geom.py 50
2025-08-22 22:29:21,584 INFO: 🔥 Configurazione multi-GPU: 4 istanze
2025-08-22 22:29:21,584 INFO: 🎯 Configurazione caricata: 4 host
Controllo host 1/4: http://127.0.0.1:39001
Attesa Ollama su http://127.0.0.1:39001...
✓ http://127.0.0.1:39001 risponde con status 200
✓ http://127.0.0.1:39001 completamente attivo
Controllo host 2/4: http://127.0.0.1:39002
Attesa Ollama su http://127.0.0.1:39002...
✓ http://127.0.0.1:39002 risponde con status 200
✓ http://127.0.0.1:39002 completamente attivo
Controllo host 3/4: http://127.0.0.1:39003
Attesa Ollama su http://127.0.0.1:39003...
✓ http://127.0.0.1:39003 risponde con status 200
✓ http://127.0.0.1:39003 completamente attivo
Controllo host 4/4: http://127.0.0.1:39004
Attesa Ollama su http://127.0.0.1:39004...
✓ http://127.0.0.1:39004 risponde con status 200
✓ http://127.0.0.1:39004 completamente attivo
Tutti gli 4 host Ollama sono pronti!
🎉 Connessione Ollama stabilita con successo!
2025-08-22 22:29:21,622 INFO: Test http://127.0.0.1:39001...
2025-08-22 22:29:21,758 INFO: http://127.0.0.1:39001 operativo
2025-08-22 22:29:21,758 INFO: Test http://127.0.0.1:39002...
2025-08-22 22:29:21,894 INFO: http://127.0.0.1:39002 operativo
2025-08-22 22:29:21,894 INFO: Test http://127.0.0.1:39003...
2025-08-22 22:29:22,031 INFO: http://127.0.0.1:39003 operativo
2025-08-22 22:29:22,031 INFO: Test http://127.0.0.1:39004...
2025-08-22 22:29:31,209 ERROR: http://127.0.0.1:39004 non funziona
2025-08-22 22:29:31,209 INFO: 3/4 host operativi
2025-08-22 22:29:31,209 INFO: Sistema multi-GPU configurato correttamente!
2025-08-22 22:29:31,211 INFO: 🎯 Processamento file singolo: veronacard_2023_original_parziale.csv
2025-08-22 22:29:31,211 INFO: 📍 Path completo: /leonardo_work/IscrC_LLM-Mob/LLM-Mob-As-Mobility-Interpreter/data/verona/veronacard_2020_2023/veronacard_2023_original_parziale.csv
2025-08-22 22:29:31,211 INFO: 🔍 Verifica iniziale hosts...
2025-08-22 22:29:31,216 INFO: ✅ http://127.0.0.1:39001 operativo
2025-08-22 22:29:31,221 INFO: ✅ http://127.0.0.1:39002 operativo
2025-08-22 22:29:31,225 INFO: ✅ http://127.0.0.1:39003 operativo
2025-08-22 22:29:31,230 INFO: ✅ http://127.0.0.1:39004 operativo
2025-08-22 22:29:31,230 INFO: 🎯 4/4 host operativi
2025-08-22 22:29:31,231 INFO: 📊 Caricamento e preprocessing dati...
2025-08-22 22:29:31,688 ERROR: ❌ Errore processando veronacard_2023_original_parziale.csv: ufunc 'add' did not contain a loop with signature matching types (dtype('int64'), dtype('<U1')) -> None
Traceback (most recent call last):
  File "/leonardo_work/IscrC_LLM-Mob/LLM-Mob-As-Mobility-Interpreter/veronacard_mob_with_geom_parrallel.py", line 1655, in <module>
    run_single_file(args.file,
  File "/leonardo_work/IscrC_LLM-Mob/LLM-Mob-As-Mobility-Interpreter/veronacard_mob_with_geom_parrallel.py", line 1548, in run_single_file
    run_on_visits_file(target_file, poi_csv,
  File "/leonardo_work/IscrC_LLM-Mob/LLM-Mob-As-Mobility-Interpreter/veronacard_mob_with_geom_parrallel.py", line 1127, in run_on_visits_file
    pois = load_pois(poi_path)
           ^^^^^^^^^^^^^^^^^^^
  File "/leonardo_work/IscrC_LLM-Mob/LLM-Mob-As-Mobility-Interpreter/veronacard_mob_with_geom_parrallel.py", line 769, in load_pois
    df["timestamp"] = pd.to_datetime(df["data"] + " " + df["ora"], 
                                     ~~~~~~~~~~~^~~~~
  File "/leonardo_work/IscrC_LLM-Mob/venv/lib/python3.11/site-packages/pandas/core/ops/common.py", line 81, in new_method
    return method(self, other)
           ^^^^^^^^^^^^^^^^^^^
  File "/leonardo_work/IscrC_LLM-Mob/venv/lib/python3.11/site-packages/pandas/core/arraylike.py", line 186, in __add__
    return self._arith_method(other, operator.add)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo_work/IscrC_LLM-Mob/venv/lib/python3.11/site-packages/pandas/core/series.py", line 6112, in _arith_method
    return base.IndexOpsMixin._arith_method(self, other, op)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo_work/IscrC_LLM-Mob/venv/lib/python3.11/site-packages/pandas/core/base.py", line 1348, in _arith_method
    result = ops.arithmetic_op(lvalues, rvalues, op)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo_work/IscrC_LLM-Mob/venv/lib/python3.11/site-packages/pandas/core/ops/array_ops.py", line 232, in arithmetic_op
    res_values = _na_arithmetic_op(left, right, op)  # type: ignore[arg-type]
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo_work/IscrC_LLM-Mob/venv/lib/python3.11/site-packages/pandas/core/ops/array_ops.py", line 171, in _na_arithmetic_op
    result = func(left, right)
             ^^^^^^^^^^^^^^^^^
numpy.core._exceptions._UFuncNoLoopError: ufunc 'add' did not contain a loop with signature matching types (dtype('int64'), dtype('<U1')) -> None

🎉 ELABORAZIONE COMPLETATA CON SUCCESSO!
⏱️ Tempo Python: 29 sec (0h 0m)

📋 REPORT FINALE HPC OTTIMIZZATO
================================
⏱️ Tempo totale job: 204 sec (0h 3m)
🚀 Modalità: HPC ottimizzato (4x A100)
✅ Python success: true

📊 RISULTATI FINALI:
   📁 File CSV: 5
   💾 Dimensione: 32M
   ⚡ Throughput: 620.68 files/hour

   📋 File recenti:
     -rw-r--r-- 1 smattiol interactive  16M Aug 22 22:20 results/dati_2014_pred_20250822_090359.csv
     -rw-r--r-- 1 smattiol interactive 4.9M Aug 22 11:09 results/dati_2017_pred_20250822_091800.csv
     -rw-r--r-- 1 smattiol interactive 5.2M Aug 22 11:02 results/dati_2019_pred_20250822_090833.csv
     -rw-r--r-- 1 smattiol interactive 4.9M Aug 22 10:54 results/dati_2018_pred_20250822_090308.csv
     -rw-r--r-- 1 smattiol interactive 235K Aug 22 10:29 results/dati_2020_pred_20250822_091241.csv

🔧 STATO GPU FINALE:
index, name, memory.used [MiB], utilization.gpu [%], temperature.gpu, power.draw [W]
0, NVIDIA A100-SXM-64GB, 26354 MiB, 0 %, 44, 79.92 W
1, NVIDIA A100-SXM-64GB, 26354 MiB, 0 %, 44, 84.08 W
2, NVIDIA A100-SXM-64GB, 26354 MiB, 0 %, 43, 74.27 W
3, NVIDIA A100-SXM-64GB, 6 MiB, 0 %, 42, 64.65 W

📜 SAMPLE LOG OLLAMA:
--- GPU 0 (ultime 3 righe) ---
[GIN] 2025/08/22 - 22:29:21 | 200 |    3.468608ms |       127.0.0.1 | GET      "/api/tags"
[GIN] 2025/08/22 - 22:29:21 | 200 |  128.738023ms |       127.0.0.1 | POST     "/api/generate"
[GIN] 2025/08/22 - 22:29:31 | 200 |     3.01486ms |       127.0.0.1 | GET      "/api/tags"
--- GPU 1 (ultime 3 righe) ---
[GIN] 2025/08/22 - 22:29:21 | 200 |    3.914311ms |       127.0.0.1 | GET      "/api/tags"
[GIN] 2025/08/22 - 22:29:21 | 200 |  128.515619ms |       127.0.0.1 | POST     "/api/generate"
[GIN] 2025/08/22 - 22:29:31 | 200 |    2.893401ms |       127.0.0.1 | GET      "/api/tags"
--- GPU 2 (ultime 3 righe) ---
[GIN] 2025/08/22 - 22:29:21 | 200 |    3.035289ms |       127.0.0.1 | GET      "/api/tags"
[GIN] 2025/08/22 - 22:29:22 | 200 |  128.931564ms |       127.0.0.1 | POST     "/api/generate"
[GIN] 2025/08/22 - 22:29:31 | 200 |    2.818867ms |       127.0.0.1 | GET      "/api/tags"
--- GPU 3 (ultime 3 righe) ---
time=2025-08-22T22:29:31.208+02:00 level=INFO source=sched.go:428 msg="NewLlamaServer failed" model=/leonardo_work/IscrC_LLM-Mob/.ollama/models/blobs/sha256-f2dc41fa964b42bfe34e9fb09c0acdcfbfd6e52f1332930b4eacc9d6ad1c6cd2 error="no suitable llama servers found"
[GIN] 2025/08/22 - 22:29:31 | 500 |  9.164271973s |       127.0.0.1 | POST     "/api/generate"
[GIN] 2025/08/22 - 22:29:31 | 200 |    2.726646ms |       127.0.0.1 | GET      "/api/tags"

🎉 JOB HPC COMPLETATO CON SUCCESSO!
⚡ Elaborazione ottimizzata su 4x A100 completata
📈 Miglioramento stimato: 66.6% vs versione originale

🏁 Fine job: Fri Aug 22 22:29:32 CEST 2025
================================
🧹 CLEANUP OTTIMIZZATO...
✅ Cleanup completato
