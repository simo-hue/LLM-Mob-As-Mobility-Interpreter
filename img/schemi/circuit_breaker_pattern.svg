<svg viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <filter id="shadow">
      <feDropShadow dx="2" dy="2" stdDeviation="2" flood-opacity="0.3"/>
    </filter>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#333"/>
    </marker>
  </defs>
  
  <!-- Titolo -->
  <text x="450" y="40" font-family="Arial, sans-serif" font-size="24" font-weight="bold" text-anchor="middle" fill="#333">
    Circuit Breaker Pattern - Gestione Resilienza Sistema
  </text>
  
  <!-- CLOSED State -->
  <g id="closed-state">
    <circle cx="200" cy="200" r="80" fill="#28a745" stroke="#1e7e34" stroke-width="3" filter="url(#shadow)"/>
    <text x="200" y="190" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">
      CLOSED
    </text>
    <text x="200" y="210" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
      (Operativo)
    </text>
    <text x="200" y="230" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
      Richieste passano
    </text>
  </g>
  
  <!-- OPEN State -->
  <g id="open-state">
    <circle cx="700" cy="200" r="80" fill="#dc3545" stroke="#bd2130" stroke-width="3" filter="url(#shadow)"/>
    <text x="700" y="190" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="white">
      OPEN
    </text>
    <text x="700" y="210" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="white">
      (Bloccato)
    </text>
    <text x="700" y="230" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="white">
      Richieste rifiutate
    </text>
  </g>
  
  <!-- HALF-OPEN State -->
  <g id="half-open-state">
    <circle cx="450" cy="500" r="80" fill="#ffc107" stroke="#d39e00" stroke-width="3" filter="url(#shadow)"/>
    <text x="450" y="490" font-family="Arial, sans-serif" font-size="18" font-weight="bold" text-anchor="middle" fill="#333">
      HALF-OPEN
    </text>
    <text x="450" y="510" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#333">
      (Test)
    </text>
    <text x="450" y="530" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#333">
      Test limitato
    </text>
  </g>
  
  <!-- Transizioni -->
  <!-- CLOSED to OPEN -->
  <path d="M 270 170 Q 450 100 630 170" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="450" y="120" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#333">
    Soglia errori raggiunta
  </text>
  <text x="450" y="140" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    (50 errori consecutivi)
  </text>
  
  <!-- OPEN to HALF-OPEN -->
  <path d="M 680 270 Q 600 380 530 480" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="620" y="380" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#333">
    Timeout scaduto
  </text>
  <text x="620" y="400" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    (300 secondi)
  </text>
  
  <!-- HALF-OPEN to CLOSED -->
  <path d="M 380 480 Q 280 380 220 270" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrow)"/>
  <text x="280" y="380" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#333">
    Test riuscito
  </text>
  <text x="280" y="400" font-family="Arial, sans-serif" font-size="10" text-anchor="middle" fill="#666">
    (Reset contatori)
  </text>
  
  <!-- HALF-OPEN to OPEN -->
  <path d="M 520 480 Q 620 380 680 270" stroke="#333" stroke-width="3" fill="none" marker-end="url(#arrow)" stroke-dasharray="5,5"/>
  <text x="600" y="340" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#333">
    Test fallito
  </text>
  
  <!-- Info boxes -->
  <rect x="50" y="350" width="250" height="120" rx="5" fill="#e7f3ff" stroke="#0066cc" filter="url(#shadow)"/>
  <text x="175" y="375" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#0066cc">
    Stato CLOSED
  </text>
  <text x="60" y="395" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Operazioni normali
  </text>
  <text x="60" y="415" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Conta errori consecutivi
  </text>
  <text x="60" y="435" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Reset su successo
  </text>
  <text x="60" y="455" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Passa a OPEN se troppi errori
  </text>
  
  <rect x="600" y="350" width="250" height="120" rx="5" fill="#ffe7e7" stroke="#cc0000" filter="url(#shadow)"/>
  <text x="725" y="375" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#cc0000">
    Stato OPEN
  </text>
  <text x="610" y="395" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Blocca tutte le richieste
  </text>
  <text x="610" y="415" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Risposta immediata errore
  </text>
  <text x="610" y="435" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Timer di recupero attivo
  </text>
  <text x="610" y="455" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Dopo timeout → HALF-OPEN
  </text>
  
  <rect x="325" y="600" width="250" height="80" rx="5" fill="#fff7e6" stroke="#cc6600" filter="url(#shadow)"/>
  <text x="450" y="625" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#cc6600">
    Stato HALF-OPEN
  </text>
  <text x="335" y="645" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Permette richieste di test
  </text>
  <text x="335" y="665" font-family="Arial, sans-serif" font-size="11" fill="#333">
    • Successo → CLOSED | Fallimento → OPEN
  </text>
</svg>