🚀 LLM-MOB PRODUCTION RUN - TUTTI GLI UTENTI
=============================================
Job ID: 18856313
Nodo: lrdn0051.leonardo.local
Data: Wed Aug 13 14:10:53 CEST 2025
💡 MODALITÀ: Processamento completo senza limiti utenti

📦 Caricamento moduli e ambiente...
Loading python/3.11.6--gcc--8.5.0
  Loading requirement: bzip2/1.0.8-gp5wcz5 libmd/1.0.4-wja3f5q
    libbsd/0.11.7-cgxjopl expat/2.5.0-bptl3xw ncurses/6.4-asx3jea
    readline/8.2-nyw6mp6 gdbm/1.23-fs6otck libiconv/1.17-d7yvx2s
    xz/5.4.1-hubmwr5 zlib-ng/2.1.4-6htiapk libxml2/2.10.3-5eeeokp
    pigz/2.7-bopr5vp zstd/1.5.5-gawytfl tar/1.34-amqus5s gettext/0.22.3-2g7elif
    libffi/3.4.4-6r7brdq libxcrypt/4.4.35-ss2rzin sqlite/3.43.2
    util-linux-uuid/2.38.1-jkdi7kv
✓ Python: Python 3.11.6
✓ Virtual env: /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/llm
✓ CUDA: Cuda compilation tools, release 12.3, V12.3.103

🔍 INFO GPU:
name, memory.total [MiB], memory.used [MiB], utilization.gpu [%], temperature.gpu
NVIDIA A100-SXM-64GB, 65536 MiB, 2 MiB, 0 %, 43
CUDA_VISIBLE_DEVICES: 0

⚙️  Configurazione Ollama...
✓ Versione Ollama: 0.3.14

🚀 Avvio server Ollama per produzione...
✓ Porta server: 39003
🧹 Pulizia processi precedenti...
✓ Server PID: 2626182
✓ Log file: ollama_production.log

⏳ Attesa avvio server (max 60s)...
✅ Server operativo dopo 10s

🔥 Preparazione modello per produzione...
📋 Modelli disponibili:
  ✓ deepseek-coder:33b
  ✓ qwen2.5:72b
  ✓ mixtral:8x7b
  ✓ llama3.1:70b
  ✓ llama3.1:8b
✅ Modello llama3.1:8b disponibile

🎯 AVVIO PRODUZIONE - PROCESSAMENTO COMPLETO
=============================================
✅ Configurazione produzione attiva
📊 Nessun limite utenti - processamento completo
⏱️  Tempo stimato: variabile (dipende dai dati)
🔄 Retry automatici: 5 tentativi per richiesta

📦 Verifica dipendenze Python...
📁 Directory risultati: /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/results/
🚀 AVVIO SCRIPT PRODUZIONE...
📝 Log dettagliato disponibile in tempo reale

2025-08-13 14:11:39,004 INFO: ✅ Ollama test passed - Response: 'How'
2025-08-13 14:11:39,150 INFO: 
======================================================================
2025-08-13 14:11:39,150 INFO: ▶  PROCESSO FILE: dati_2014.csv
2025-08-13 14:11:39,150 INFO: ======================================================================
2025-08-13 14:11:39,150 INFO: ▶  ho caricato e pulito i dati
2025-08-13 14:11:39,152 INFO: [load_pois] 22 POI letti da /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/data/verona/vc_site.csv
2025-08-13 14:11:41,056 INFO: [load_visits] 370377 timbrature da /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/data/verona/dataset_veronacard_2014_2020/dati_2014.csv
2025-08-13 14:11:41,136 INFO: [merge] visite valide dopo merge: 370377
2025-08-13 14:11:41,297 INFO: [filter] card multi-visita: 70236 / 71557
2025-08-13 14:11:42,523 INFO: ▶  ho fatto il clustering
👉 Porta letta da ollama_port.txt: '39003'
👉 Provo a contattare http://127.0.0.1:39003/api/tags
📂 Working dir: /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter
📄 Contenuto di ollama_port.txt: '39003'
🔄 Attesa Ollama su http://127.0.0.1:39003...
✓ Ollama risponde con status 200
✓ Runner LLaMA completamente attivo
🎉 Connessione Ollama stabilita con successo!
Card: 0card [00:00, ?card/s]Card: 0card [00:00, ?card/s]
2025-08-13 14:11:42,531 WARNING: ⚠️  Nessun risultato da salvare!
2025-08-13 14:11:42,679 INFO: 
======================================================================
2025-08-13 14:11:42,679 INFO: ▶  PROCESSO FILE: dati_2015.csv
2025-08-13 14:11:42,679 INFO: ======================================================================
2025-08-13 14:11:42,680 INFO: ▶  ho caricato e pulito i dati
2025-08-13 14:11:42,681 INFO: [load_pois] 22 POI letti da /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/data/verona/vc_site.csv
2025-08-13 14:11:44,598 INFO: [load_visits] 369587 timbrature da /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/data/verona/dataset_veronacard_2014_2020/dati_2015.csv
2025-08-13 14:11:44,664 INFO: [merge] visite valide dopo merge: 369587
2025-08-13 14:11:44,828 INFO: [filter] card multi-visita: 71759 / 73424
2025-08-13 14:11:46,067 INFO: ▶  ho fatto il clustering
Card: 0card [00:00, ?card/s]Card: 0card [00:00, ?card/s]
2025-08-13 14:11:46,073 WARNING: ⚠️  Nessun risultato da salvare!
2025-08-13 14:11:46,225 INFO: 
======================================================================
2025-08-13 14:11:46,225 INFO: ▶  PROCESSO FILE: dati_2016.csv
2025-08-13 14:11:46,225 INFO: ======================================================================
2025-08-13 14:11:46,225 INFO: ▶  ho caricato e pulito i dati
2025-08-13 14:11:46,226 INFO: [load_pois] 22 POI letti da /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/data/verona/vc_site.csv
2025-08-13 14:11:48,303 INFO: [load_visits] 383516 timbrature da /leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/data/verona/dataset_veronacard_2014_2020/dati_2016.csv
2025-08-13 14:11:48,376 INFO: [merge] visite valide dopo merge: 383516
2025-08-13 14:11:48,554 INFO: [filter] card multi-visita: 76451 / 78152
2025-08-13 14:11:49,630 INFO: ▶  ho fatto il clustering
Card: 0card [00:00, ?card/s]Card: 0card [00:00, ?card/s]
2025-08-13 14:11:49,640 WARNING: ⚠️  Nessun risultato da salvare!
Traceback (most recent call last):
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/veronacard_mob_with_geom.py", line 1154, in <module>
    run_all_verona_logs(max_users=args.max_users,
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/veronacard_mob_with_geom.py", line 1042, in run_all_verona_logs
    run_on_visits_file(csv, poi_csv,
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/veronacard_mob_with_geom.py", line 874, in run_on_visits_file
    prev_df = pd.read_csv(prev_path, usecols=['card_id'])
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/llm/lib/python3.11/site-packages/pandas/io/parsers/readers.py", line 912, in read_csv
    return _read(filepath_or_buffer, kwds)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/llm/lib/python3.11/site-packages/pandas/io/parsers/readers.py", line 577, in _read
    parser = TextFileReader(filepath_or_buffer, **kwds)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/llm/lib/python3.11/site-packages/pandas/io/parsers/readers.py", line 1407, in __init__
    self._engine = self._make_engine(f, self.engine)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/llm/lib/python3.11/site-packages/pandas/io/parsers/readers.py", line 1679, in _make_engine
    return mapping[engine](f, **self.options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/llm/lib/python3.11/site-packages/pandas/io/parsers/c_parser_wrapper.py", line 140, in __init__
    self._validate_usecols_names(usecols, self.orig_names)
  File "/leonardo/home/userexternal/smattiol/LLM-Mob-As-Mobility-Interpreter/llm/lib/python3.11/site-packages/pandas/io/parsers/base_parser.py", line 959, in _validate_usecols_names
    raise ValueError(
ValueError: Usecols do not match columns, columns expected but not found: ['card_id']

❌ ERRORE IN PRODUZIONE (exit code: 1)
⏱️  Tempo prima del fallimento: 18 secondi
⚠️  Errore generico - controllare log

📋 REPORT FINALE PRODUZIONE
============================
⏱️  Tempo totale job: 56 secondi (0h 0m)
🔧 Versione Ollama: 0.3.14
📊 Modalità: Produzione completa (tutti gli utenti)
/var/spool/slurmd/job18856313/slurm_script: line 330: 2626750 Terminated              monitor_progress
✅ Python success: false

📁 RISULTATI GENERATI:
   📊 Total files: 4
   💾 Total size: 46M

   📋 File generati:
     -rw-r--r-- 1 smattiol interactive 15M Aug  7 14:36 results/dati_2014_pred_20250806_180856.csv
     -rw-r--r-- 1 smattiol interactive 16M Aug  8 14:52 results/dati_2015_pred_20250807_181256.csv
     -rw-r--r-- 1 smattiol interactive 16M Aug  9 15:37 results/dati_2016_pred_20250808_175223.csv
     -rw-r--r-- 1 smattiol interactive 46K Aug 13 14:09 results/dati_2017_pred_20250813_140602.csv

🔧 STATO FINALE SISTEMA:
memory.used [MiB], memory.total [MiB], utilization.gpu [%], temperature.gpu
5766 MiB, 65536 MiB, 0 %, 44

📊 LOG OLLAMA (ultimi 20 righe):
llm_load_tensors: offloading non-repeating layers to GPU
llm_load_tensors: offloaded 33/33 layers to GPU
llm_load_tensors:        CPU buffer size =   281.81 MiB
llm_load_tensors:      CUDA0 buffer size =  4403.50 MiB
llama_new_context_with_model: n_ctx      = 4096
llama_new_context_with_model: n_batch    = 512
llama_new_context_with_model: n_ubatch   = 512
llama_new_context_with_model: flash_attn = 0
llama_new_context_with_model: freq_base  = 500000.0
llama_new_context_with_model: freq_scale = 1
llama_kv_cache_init:      CUDA0 KV buffer size =   512.00 MiB
llama_new_context_with_model: KV self size  =  512.00 MiB, K (f16):  256.00 MiB, V (f16):  256.00 MiB
llama_new_context_with_model:  CUDA_Host  output buffer size =     1.01 MiB
llama_new_context_with_model:      CUDA0 compute buffer size =   296.00 MiB
llama_new_context_with_model:  CUDA_Host compute buffer size =    16.01 MiB
llama_new_context_with_model: graph nodes  = 1030
llama_new_context_with_model: graph splits = 2
INFO [main] model loaded | tid="22482667286528" timestamp=1755087098
time=2025-08-13T14:11:38.897+02:00 level=INFO source=server.go:626 msg="llama runner started in 5.27 seconds"
[GIN] 2025/08/13 - 14:11:39 | 200 |  5.624741898s |       127.0.0.1 | POST     "/api/generate"

⚠️ JOB PRODUZIONE TERMINATO CON ERRORI
📋 Verificare log per dettagli specifici

🏁 Fine job: Wed Aug 13 14:11:49 CEST 2025
=============================================

🧹 CLEANUP PRODUZIONE...
🕐 Tempo totale job: 56 secondi (0h 0m)
📊 Stato GPU finale:
memory.used [MiB], memory.total [MiB], utilization.gpu [%], temperature.gpu
5766 MiB, 65536 MiB, 0 %, 44
📁 Risultati generati: 4 files
💾 Dimensione risultati: 46M
🔄 Shutdown graceful Ollama...
✓ Cleanup completato
