🚀 VERONA CARD - TIME DEBUG
================================================
🐛 DEBUG MODE: 1 GPU seriale, max 10 carte, prompt debugging attivo
Job ID: 19686020
Nodo: lrdn1113.leonardo.local
Data: Fri Sep  5 13:52:00 CEST 2025

📦 Setup ambiente HPC...
Loading python/3.11.6--gcc--8.5.0
  Loading requirement: bzip2/1.0.8-gp5wcz5 libmd/1.0.4-wja3f5q
    libbsd/0.11.7-cgxjopl expat/2.5.0-bptl3xw ncurses/6.4-asx3jea
    readline/8.2-nyw6mp6 gdbm/1.23-fs6otck libiconv/1.17-d7yvx2s
    xz/5.4.1-hubmwr5 zlib-ng/2.1.4-6htiapk libxml2/2.10.3-5eeeokp
    pigz/2.7-bopr5vp zstd/1.5.5-gawytfl tar/1.34-amqus5s gettext/0.22.3-2g7elif
    libffi/3.4.4-6r7brdq libxcrypt/4.4.35-ss2rzin sqlite/3.43.2
    util-linux-uuid/2.38.1-jkdi7kv
✅ Python: Python 3.11.6
✅ CUDA: Cuda compilation tools, release 12.3, V12.3.103

🔍 GPU DETECTION:
0, NVIDIA A100-SXM-64GB, 65536 MiB, 42

📁 Directory temporanea: /leonardo_work/IscrC_LLM-Mob/tmp_ollama_19686020
💾 Spazio disponibile: 724GB

🧹 Cleanup preventivo...

🚀 AVVIO SISTEMA OLLAMA
========================

🔧 Avvio GPU 0 su porta 39001...
✅ GPU 0 PID: 2285754 (NO TIMEOUT)
⏳ GPU 0 è MASTER - attesa caricamento modello SENZA LIMITI...
   🌐 API risponde, test modello...
   ✅ GPU 0 PRONTA dopo 2 tentativi!

✅ GPU 0 completamente operativa con modello caricato
🐛 DEBUG: Saltando altre GPU - modalità seriale attiva

🔍 VERIFICA FINALE SISTEMA
===========================
GPU 0 (porta 39001): ✅ OPERATIVA

📊 RISULTATO: 1/1 GPU operativa
✅ Porta salvata: 39001
📊 Starting Advanced GPU Monitor (ogni 60s)

🐍 AVVIO PYTHON
===============

🐛 DEBUG: Processing with max 10 cards for prompt analysis
2025-09-05 13:55:29 [INFO] 🐛 DEBUG MODE ENABLED - Serial execution with prompt debugging
2025-09-05 13:55:29 [INFO] 🐛 Max cards: 10
2025-09-05 13:55:29 [INFO] 🐛 Debug prompts: First 3 will be saved
2025-09-05 13:55:29 [INFO] 🐛 Timeout: 600s
2025-09-05 13:55:29 [INFO] Initializing Ollama connection manager...
2025-09-05 13:55:29 [WARNING] HostHealthMonitor initialized with empty host list
2025-09-05 13:55:29 [INFO] Setting up connections...
2025-09-05 13:55:29 [INFO] Single GPU configuration: http://127.0.0.1:39001
2025-09-05 13:55:29 [INFO] Initialized with 1 hosts
2025-09-05 13:55:29 [INFO] Waiting for Ollama services to start...
2025-09-05 13:55:29 [INFO] Checking host 1/1: http://127.0.0.1:39001
2025-09-05 13:55:29 [INFO] Host http://127.0.0.1:39001 is ready
2025-09-05 13:55:29 [INFO] All Ollama services are ready!
2025-09-05 13:55:29 [INFO] 🔍 Checking available models on all hosts...
2025-09-05 13:55:29 [INFO] 📋 http://127.0.0.1:39001: ['mistral:7b', 'codellama:34b', 'deepseek-r1:32b', 'mixtral:8x22b', 'llama3.1:70b', 'qwen2.5:72b-instruct', 'qwen2.5:7b', 'qwen2.5:14b', 'deepseek-coder:33b', 'mixtral:8x7b', 'llama3.1:8b']
2025-09-05 13:55:29 [INFO] ✅ Model qwen2.5:7b available on http://127.0.0.1:39001
2025-09-05 13:55:29 [INFO] Found 12 files to process
2025-09-05 13:55:29 [INFO] Processing dati_2014.csv
2025-09-05 13:55:29 [INFO] Loaded 8 completed cards from checkpoint
2025-09-05 13:55:29 [INFO] Loading and preprocessing data...
2025-09-05 13:55:30 [INFO] Loaded 22 POIs from vc_site.csv
2025-09-05 13:55:32 [INFO] Loaded 370377 visits from dati_2014.csv
2025-09-05 13:55:32 [INFO] Valid visits after merge: 370377
2025-09-05 13:55:32 [INFO] Multi-visit cards: 70236 / 71557
2025-09-05 13:55:32 [INFO] Performing user clustering...
2025-09-05 13:55:38 [INFO] Processing 10 cards
2025-09-05 13:55:38 [INFO] Using 1 workers for 1 healthy hosts
2025-09-05 13:55:38 [INFO] Waiting 30s for models to stabilize...
2025-09-05 13:56:08 [INFO] Running pre-flight check on all hosts...
2025-09-05 13:56:09 [INFO] ✅ Pre-flight check passed for http://127.0.0.1:39001
2025-09-05 13:56:09 [INFO] ✅ ALL PRE-FLIGHT CHECKS PASSED - Starting progressive warm-up
2025-09-05 13:56:09 [INFO] 🐛 DEBUG MODE: Skipping warm-up - direct model loading test
2025-09-05 13:56:09 [INFO] 🔧 Testing model availability directly...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 GPU STATUS - 2025-09-05 13:57:50
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
GPU 0: 💤 IDLE
  Compute:   0% | Memory:   0% ( 1420/ 65536 MB)
  Temp: 43°C | Power:  78.82 W

🔄 Processi Ollama:
  GPU 0 (PID 2285754): ✅ CPU: 7.8% | RAM: 1.0GB | Port: 39001
    └─ API: ✅ Responsive
  GPU 1: ❌ Process not running
  GPU 2: ❌ Process not running
  GPU 3: ❌ Process not running

🐍 Python Processing:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 GPU STATUS - 2025-09-05 14:00:50
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
GPU 0: 💤 IDLE
  Compute:   0% | Memory:   0% ( 1426/ 65536 MB)
  Temp: 43°C | Power:  78.57 W

🔄 Processi Ollama:
  GPU 0 (PID 2285754): ✅ CPU: 5.0% | RAM: 1.0GB | Port: 39001
    └─ API: ✅ Responsive
  GPU 1: ❌ Process not running
  GPU 2: ❌ Process not running
  GPU 3: ❌ Process not running

🐍 Python Processing:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
slurmstepd: error: *** JOB 19686020 ON lrdn1113 CANCELLED AT 2025-09-05T14:01:24 ***

🧹 Cleanup finale...
Stopping PID 2285754...
2025-09-05 14:01:24 [ERROR] Unexpected error on http://127.0.0.1:39001: ('Connection aborted.', RemoteDisconnected('Remote end closed connection without response'))
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] No healthy hosts available
2025-09-05 14:01:26 [WARNING] Health check failed for http://127.0.0.1:39001: HTTPConnectionPool(host='127.0.0.1', port=39001): Max retries exceeded with url: /api/tags (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x14e417190c10>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] Request failed completely: All hosts are down
2025-09-05 14:01:26 [WARNING] ⚠️ Model test returned no response - continuing anyway for debug
2025-09-05 14:01:26 [INFO] 🐛 DEBUG MODE: Skipping GPU preloading to avoid conflicts
2025-09-05 14:01:26 [INFO] 🚀 Starting production processing...
Processing cards:   0%|          | 0/10 [00:00<?, ?card/s]2025-09-05 14:01:26 [INFO] 🐛 DEBUG: Saved prompt #1 to prompt_01_04D86C8ABF3180_20250905_140126.txt (997 chars)
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] No healthy hosts available
2025-09-05 14:01:26 [WARNING] Health check failed for http://127.0.0.1:39001: HTTPConnectionPool(host='127.0.0.1', port=39001): Max retries exceeded with url: /api/tags (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x14e4168b0ad0>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] Request failed completely: All hosts are down
2025-09-05 14:01:26 [INFO] 🐛 DEBUG: Saved prompt #2 to prompt_02_04E278523F3880_20250905_140126.txt (1090 chars)
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] No healthy hosts available
2025-09-05 14:01:26 [WARNING] Health check failed for http://127.0.0.1:39001: HTTPConnectionPool(host='127.0.0.1', port=39001): Max retries exceeded with url: /api/tags (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x14e4172a5e10>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] Request failed completely: All hosts are down
2025-09-05 14:01:26 [INFO] 🐛 DEBUG: Saved prompt #3 to prompt_03_04F0A6523F3880_20250905_140126.txt (1116 chars)
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] No healthy hosts available
2025-09-05 14:01:26 [WARNING] Health check failed for http://127.0.0.1:39001: HTTPConnectionPool(host='127.0.0.1', port=39001): Max retries exceeded with url: /api/tags (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x14e4172abe90>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] Request failed completely: All hosts are down
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] No healthy hosts available
2025-09-05 14:01:26 [WARNING] Health check failed for http://127.0.0.1:39001: HTTPConnectionPool(host='127.0.0.1', port=39001): Max retries exceeded with url: /api/tags (Caused by NewConnectionError('<urllib3.connection.HTTPConnection object at 0x14e4172ac910>: Failed to establish a new connection: [Errno 111] Connection refused'))
2025-09-05 14:01:26 [WARNING] No healthy hosts found, attempting recovery...
2025-09-05 14:01:26 [ERROR] Circuit breaker OPEN after 5 failures
2025-09-05 14:01:26 [ERROR] Request failed completely: All hosts are down
Processing cards:  40%|████      | 4/10 [00:00<00:00, 38.14card/s]2025-09-05 14:01:26 [ERROR] 💥 CIRCUIT BREAKER ACTIVE - SYSTEM FAILURE DETECTED
2025-09-05 14:01:26 [ERROR] 🛑 All Ollama instances have failed. Processing must stop.
2025-09-05 14:01:26 [ERROR] 🔧 Check GPU memory, processes, and logs before restarting.
2025-09-05 14:01:26 [ERROR] Fatal error processing card 044B0E4A3F3884: Circuit breaker active - system failure detected. Processing stopped.
2025-09-05 14:01:26 [WARNING] Fatal error for card 044B0E4A3F3884
2025-09-05 14:01:26 [ERROR] 💥 CIRCUIT BREAKER ACTIVE - SYSTEM FAILURE DETECTED
2025-09-05 14:01:26 [ERROR] 🛑 All Ollama instances have failed. Processing must stop.
2025-09-05 14:01:26 [ERROR] 🔧 Check GPU memory, processes, and logs before restarting.
2025-09-05 14:01:26 [ERROR] Fatal error processing card 04CF1B523F3880: Circuit breaker active - system failure detected. Processing stopped.
2025-09-05 14:01:26 [WARNING] Fatal error for card 04CF1B523F3880
2025-09-05 14:01:26 [ERROR] 💥 CIRCUIT BREAKER ACTIVE - SYSTEM FAILURE DETECTED
2025-09-05 14:01:26 [ERROR] 🛑 All Ollama instances have failed. Processing must stop.
2025-09-05 14:01:26 [ERROR] 🔧 Check GPU memory, processes, and logs before restarting.
2025-09-05 14:01:26 [ERROR] Fatal error processing card 04B6AF523F3880: Circuit breaker active - system failure detected. Processing stopped.
2025-09-05 14:01:26 [WARNING] Fatal error for card 04B6AF523F3880
2025-09-05 14:01:26 [ERROR] 💥 CIRCUIT BREAKER ACTIVE - SYSTEM FAILURE DETECTED
2025-09-05 14:01:26 [ERROR] 🛑 All Ollama instances have failed. Processing must stop.
2025-09-05 14:01:26 [ERROR] 🔧 Check GPU memory, processes, and logs before restarting.
2025-09-05 14:01:26 [ERROR] Fatal error processing card 04ED7D8ABF3180: Circuit breaker active - system failure detected. Processing stopped.
2025-09-05 14:01:26 [WARNING] Fatal error for card 04ED7D8ABF3180
2025-09-05 14:01:26 [ERROR] 💥 CIRCUIT BREAKER ACTIVE - SYSTEM FAILURE DETECTED
2025-09-05 14:01:26 [ERROR] 🛑 All Ollama instances have failed. Processing must stop.
2025-09-05 14:01:26 [ERROR] 🔧 Check GPU memory, processes, and logs before restarting.
2025-09-05 14:01:26 [ERROR] Fatal error processing card 04BA1D523F3884: Circuit breaker active - system failure detected. Processing stopped.
2025-09-05 14:01:26 [WARNING] Fatal error for card 04BA1D523F3884
2025-09-05 14:01:26 [ERROR] 💥 CIRCUIT BREAKER ACTIVE - SYSTEM FAILURE DETECTED
2025-09-05 14:01:26 [ERROR] 🛑 All Ollama instances have failed. Processing must stop.
2025-09-05 14:01:26 [ERROR] 🔧 Check GPU memory, processes, and logs before restarting.
2025-09-05 14:01:26 [ERROR] Fatal error processing card 0463784A3F3880: Circuit breaker active - system failure detected. Processing stopped.
2025-09-05 14:01:26 [WARNING] Fatal error for card 0463784A3F3880
Processing cards: 100%|██████████| 10/10 [00:00<00:00, 77.75card/s]
2025-09-05 14:01:26 [INFO] Completed processing dati_2014.csv
2025-09-05 14:01:26 [INFO] Success rate: 0.0%
2025-09-05 14:01:26 [INFO] Processing dati_2015.csv
2025-09-05 14:01:26 [INFO] Loading and preprocessing data...
2025-09-05 14:01:26 [INFO] Loaded 22 POIs from vc_site.csv
2025-09-05 14:01:28 [INFO] Loaded 369588 visits from dati_2015.csv
2025-09-05 14:01:28 [INFO] Valid visits after merge: 369588
2025-09-05 14:01:28 [INFO] Multi-visit cards: 71759 / 73424
2025-09-05 14:01:28 [INFO] Performing user clustering...
Removing /leonardo_work/IscrC_LLM-Mob/tmp_ollama_19686020...
✅ Cleanup completato
