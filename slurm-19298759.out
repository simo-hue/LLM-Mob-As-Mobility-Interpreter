🚀 VERONA CARD HPC
================================================
Job ID: 19298759
Nodo: lrdn0631.leonardo.local
Data: Sun Aug 24 11:16:40 CEST 2025
🎯 Modalità: Produzione stabile (4x A100, anti-contention)

📦 Setup ambiente HPC...
Loading python/3.11.6--gcc--8.5.0
  Loading requirement: bzip2/1.0.8-gp5wcz5 libmd/1.0.4-wja3f5q
    libbsd/0.11.7-cgxjopl expat/2.5.0-bptl3xw ncurses/6.4-asx3jea
    readline/8.2-nyw6mp6 gdbm/1.23-fs6otck libiconv/1.17-d7yvx2s
    xz/5.4.1-hubmwr5 zlib-ng/2.1.4-6htiapk libxml2/2.10.3-5eeeokp
    pigz/2.7-bopr5vp zstd/1.5.5-gawytfl tar/1.34-amqus5s gettext/0.22.3-2g7elif
    libffi/3.4.4-6r7brdq libxcrypt/4.4.35-ss2rzin sqlite/3.43.2
    util-linux-uuid/2.38.1-jkdi7kv
✅ Python: Python 3.11.6
✅ CUDA: Cuda compilation tools, release 12.3, V12.3.103

🔍 GPU DETECTION:
0, NVIDIA A100-SXM-64GB, 65536 MiB, 43
1, NVIDIA A100-SXM-64GB, 65536 MiB, 43
2, NVIDIA A100-SXM-64GB, 65536 MiB, 42
3, NVIDIA A100-SXM-64GB, 65536 MiB, 42
SLURM GPUs: 4

💾 LEONARDO BOOSTER: Setup spazio temporaneo ottimizzato...
📊 Spazio /tmp Leonardo Booster: 10GB disponibili su ~10GB totali
✅ Configurazione Leonardo Booster:
   📁 /tmp originale: 10GB (TROPPO PICCOLO per Mixtral)
   📁 Directory custom: /leonardo_work/IscrC_LLM-Mob/tmp_ollama_19298759
   💾 Spazio $WORK disponibile: 951GB
   🎯 Mixtral richiede ~26GB temporanei - OK con $WORK

🧹 Cleanup preventivo Leonardo Booster...
🔍 Stato spazio post-cleanup:
💾 /tmp: 10G disponibili
💾 $WORK: 952G disponibili
📂 Directory temporanea: total 8.0K
drwx------ 2 smattiol interactive   4.0K Aug 24 11:16 .
drwxrwx--- 9 smattiol IscrC_LLM-Mob 4.0K Aug 24 11:16 ..
🔍 Configurazioni Ollama attive:
OLLAMA_BATCH_SIZE=1024
OLLAMA_CACHE_DIR=/leonardo_work/IscrC_LLM-Mob/.ollama/cache
OLLAMA_CONTEXT_SIZE=4096
OLLAMA_CUDA_MEMORY_FRACTION=0.85
OLLAMA_DEBUG=1
OLLAMA_FLASH_ATTENTION=1
OLLAMA_GPU_LAYERS=-1
OLLAMA_KEEP_ALIVE=4h
OLLAMA_LLM_LIBRARY=cuda_v12
OLLAMA_LOAD_TIMEOUT=3600
OLLAMA_MAX_CONCURRENT_DOWNLOADS=1
OLLAMA_MAX_LOADED_MODELS=1
OLLAMA_MAX_QUEUE=1
OLLAMA_MAX_VRAM_USAGE=0.85
OLLAMA_MODELS=/leonardo_work/IscrC_LLM-Mob/.ollama/models
OLLAMA_NUM_PARALLEL=1
OLLAMA_ORIGINS=*
OLLAMA_PREDICTION_TOKENS=512
OLLAMA_REQUEST_TIMEOUT=600
OLLAMA_RUNNER_CACHE_SIZE=8GB
OLLAMA_TMPDIR=/leonardo_work/IscrC_LLM-Mob/tmp_ollama_19298759
OLLAMA_VERBOSE=1

🧹 Cleanup preventivo...
🔍 Controllo stato GPU post-cleanup...
0, NVIDIA A100-SXM-64GB, 2 MiB, 43
1, NVIDIA A100-SXM-64GB, 2 MiB, 43
2, NVIDIA A100-SXM-64GB, 2 MiB, 42
3, NVIDIA A100-SXM-64GB, 2 MiB, 42
# gpu         pid  type    sm    mem    enc    dec    command
# Idx           #   C/G     %      %      %      %    name
    0          -     -     -     -     -     -   -              
    1          -     -     -     -     -     -   -              
    2          -     -     -     -     -     -   -              
    3          -     -     -     -     -     -   -              

🚀 Avvio server Ollama con anti-contention...

🚀 Avvio server Ollama con anti-contention POTENZIATO...
🔡 Avvio istanza 1/4 (MASTER)...
🔥 Avvio ROBUSTO istanza GPU 0 su porta 39001...
🧹 Cleanup specifico porta 39001...
✅ GPU 0: spazio OK (951GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu0
🚀 Avvio Ollama GPU 0 con timeout esteso...
✅ GPU 0 PID: 818283 (timeout startup: 900s)
   📁 Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu0
   📄 Log: ollama_gpu0.log
✅ GPU 0: processo avviato correttamente
⏳ Attesa caricamento modello su GPU 0 MASTER (180s)...
🔡 Avvio istanza 2/4...
🔥 Avvio ROBUSTO istanza GPU 1 su porta 39002...
🧹 Cleanup specifico porta 39002...
✅ GPU 1: spazio OK (948GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu1
🚀 Avvio Ollama GPU 1 con timeout esteso...
✅ GPU 1 PID: 818579 (timeout startup: 900s)
   📁 Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu1
   📄 Log: ollama_gpu1.log
✅ GPU 1: processo avviato correttamente
⏳ Attesa stabilizzazione GPU 1 (90s)...
🔡 Avvio istanza 3/4...
🔥 Avvio ROBUSTO istanza GPU 2 su porta 39003...
🧹 Cleanup specifico porta 39003...
✅ GPU 2: spazio OK (946GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu2
🚀 Avvio Ollama GPU 2 con timeout esteso...
✅ GPU 2 PID: 818630 (timeout startup: 900s)
   📁 Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu2
   📄 Log: ollama_gpu2.log
✅ GPU 2: processo avviato correttamente
⏳ Attesa stabilizzazione GPU 2 (90s)...
🔡 Avvio istanza 4/4...
🔥 Avvio ROBUSTO istanza GPU 3 su porta 39004...
🧹 Cleanup specifico porta 39004...
✅ GPU 3: spazio OK (943GB), cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu3
🚀 Avvio Ollama GPU 3 con timeout esteso...
✅ GPU 3 PID: 818680 (timeout startup: 900s)
   📁 Cache: /leonardo_work/IscrC_LLM-Mob/.ollama/cache/gpu3
   📄 Log: ollama_gpu3.log
✅ GPU 3: processo avviato correttamente
⏳ Attesa stabilizzazione GPU 3 (90s)...
⏳ Attesa stabilizzazione COMPLETA sistema (120s)...
🔍 Verifica processi Ollama attivi:
✅ GPU 0: PID 818283 attivo
✅ GPU 1: PID 818579 attivo
✅ GPU 2: PID 818630 attivo
✅ GPU 3: PID 818680 attivo

🔍 Health check SUPER-ROBUSTO multi-istanza...
📋 Prima passata health check...
🔍 Health check GPU 0 (porta 39001)...
👑 GPU 0 MASTER - timeout esteso (30 tentativi)
   🔄 Tentativo 1/30...
   🌐 Test connessione...
   ✅ Connessione OK, test funzionalità...
   ⚠️ Test inference fallito, risposta parziale: ...
   🔄 Tentativo 2/30...
   🌐 Test connessione...
   ✅ Connessione OK, test funzionalità...
   ✅ GPU 0 COMPLETAMENTE OPERATIVA dopo 2 tentativi
GPU 0 fallita prima passata
🔍 Health check GPU 1 (porta 39002)...
   🔄 Tentativo 1/20...
   🌐 Test connessione...
   ✅ Connessione OK, test funzionalità...
   ✅ GPU 1 COMPLETAMENTE OPERATIVA dopo 1 tentativi
🔍 Health check GPU 2 (porta 39003)...
   🔄 Tentativo 1/20...
   🌐 Test connessione...
   ✅ Connessione OK, test funzionalità...
   ✅ GPU 2 COMPLETAMENTE OPERATIVA dopo 1 tentativi
🔍 Health check GPU 3 (porta 39004)...
   🔄 Tentativo 1/20...
   🌐 Test connessione...
   ✅ Connessione OK, test funzionalità...
   ✅ GPU 3 COMPLETAMENTE OPERATIVA dopo 1 tentativi
📊 Prima passata: 4/4 istanze operative
📊 Health check finale: 4/4 istanze operative
✅ Sistema OTTIMO: 4 GPU operative

🔥 VERIFICA E PREPARAZIONE MODELLO FINALE
========================================
🔍 Verifica modello mixtral:8x7b...
🔍 Tentativo check modello su porta 39001 (GPU 0)...
✅ Connessione modello OK su porta 39001
🔍 Modello presente: true
✅ Modello già presente

🔥 WARM-UP REALE E DEFINITIVO
============================
⚠️ Questo è il test FINALE che determina quali GPU sono REALMENTE pronte
⏳ Può richiedere 3-10 minuti ma è ESSENZIALE per evitare errori 503

🎯 Test FINALE GPU 0...
🎯 TEST REALE GPU 0 (porta 39001)...
   🔄 Tentativo 1/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   📊 Prima risposta: {"model":"mixtral:8x7b","created_at":"2025-08-24T09:32:01.684565433Z","message":{"role":"assistant","content":"�wandering to Verona, Italy? Don't miss"},"done_reason":"length","done":true,"total_dur...
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 2/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 3/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 4/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 5/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 6/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 7/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 8/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   ❌ GPU 0: Fallita dopo 8 tentativi (360s)
❌ GPU 0 NON pronta - ESCLUSA dal processing
⏸️ Pausa anti-contention (30s)...

🎯 Test FINALE GPU 1...
🎯 TEST REALE GPU 1 (porta 39002)...
   🔄 Tentativo 1/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   📊 Prima risposta: ...
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 2/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 3/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 4/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 5/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 6/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 7/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 8/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   ❌ GPU 1: Fallita dopo 8 tentativi (360s)
❌ GPU 1 NON pronta - ESCLUSA dal processing
⏸️ Pausa anti-contention (30s)...

🎯 Test FINALE GPU 2...
🎯 TEST REALE GPU 2 (porta 39003)...
   🔄 Tentativo 1/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   📊 Prima risposta: ...
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 2/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
   🔄 Tentativo 3/8 (test reale inferenza)...
   ❌ Test fallito o risposta invalida
   ⏳ Attesa 45s (caricamento modello in corso)...
slurmstepd: error: *** JOB 19298759 ON lrdn0631 CANCELLED AT 2025-08-24T11:46:43 ***
🧹 CLEANUP STABILIZZATO...
⏳ Attesa shutdown (30s)...
🔨 Force cleanup...
✅ Cleanup completato
